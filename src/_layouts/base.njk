<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if title %}{{ title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,700;1,400&family=PT+Sans:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="/feed.xml">
    
    <!-- SEO Meta Tags -->
    <meta property="og:title" content="{% if title %}{{ title }}{% else %}{{ site.title }}{% endif %}">
    <meta property="og:description" content="{% if description %}{{ description }}{% else %}{{ site.description }}{% endif %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ site.url }}{{ page.url }}">
    
    <!-- No JavaScript frameworks - keep it simple and fast -->
</head>
<body>
    <main>
        {{ content | safe }}
    </main>

    <!-- Time-based gradient background script -->
    <script>
    (function() {
      'use strict';

      // 24-hour gradient color stops [hour, top HSL (hue1, sat, light), bottom HSL (hue2, sat, light)]
      // Ultra-light creative gradients with unconventional color mixes
      const stops = [
        { h: 0,  c1: [260,28,86], c2: [180,22,89] },  // Night: Lavender → Mint (dreamy)
        { h: 3,  c1: [280,25,88], c2: [330,23,91] },  // Late night: Purple → Pink (ethereal)
        { h: 6,  c1: [350,30,91], c2: [60,25,93] },   // Dawn: Rose → Butter (warm awakening)
        { h: 8,  c1: [45,22,93],  c2: [150,18,92] },  // Early morning: Peach → Seafoam (fresh)
        { h: 9,  c1: [200,20,94], c2: [50,18,95] },   // Morning: Sky → Cream (bright)
        { h: 11, c1: [170,18,95], c2: [300,16,94] },  // Late morning: Aqua → Lilac (serene)
        { h: 12, c1: [190,15,96], c2: [320,14,96] },  // Noon: Ice blue → Pale rose (brightest)
        { h: 14, c1: [140,16,95], c2: [40,18,94] },   // Early afternoon: Mint → Lemon (crisp)
        { h: 15, c1: [55,20,93],  c2: [340,22,91] },  // Afternoon: Lime → Blush (playful)
        { h: 17, c1: [20,25,91],  c2: [280,24,89] },  // Late afternoon: Coral → Mauve (golden hour)
        { h: 18, c1: [330,28,89], c2: [240,22,87] },  // Dusk: Pink → Periwinkle (sunset)
        { h: 20, c1: [250,22,85], c2: [160,18,84] },  // Evening: Lavender → Teal (twilight)
        { h: 21, c1: [270,24,85], c2: [190,20,87] },  // Late evening: Purple → Cyan (mystical)
        { h: 23, c1: [230,22,87], c2: [300,20,88] }   // Night: Blue → Orchid (calm)
      ];

      // Calculate relative luminance for contrast ratio
      function getLuminance(r, g, b) {
        const [rs, gs, bs] = [r, g, b].map(c => {
          c = c / 255;
          return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
        });
        return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
      }

      // Convert HSL to RGB
      function hslToRgb(h, s, l) {
        s /= 100;
        l /= 100;
        const c = (1 - Math.abs(2 * l - 1)) * s;
        const x = c * (1 - Math.abs((h / 60) % 2 - 1));
        const m = l - c / 2;
        let r, g, b;
        if (h < 60) { r = c; g = x; b = 0; }
        else if (h < 120) { r = x; g = c; b = 0; }
        else if (h < 180) { r = 0; g = c; b = x; }
        else if (h < 240) { r = 0; g = x; b = c; }
        else if (h < 300) { r = x; g = 0; b = c; }
        else { r = c; g = 0; b = x; }
        return [
          Math.round((r + m) * 255),
          Math.round((g + m) * 255),
          Math.round((b + m) * 255)
        ];
      }

      // Calculate contrast ratio between two colors
      function getContrastRatio(lum1, lum2) {
        const lighter = Math.max(lum1, lum2);
        const darker = Math.min(lum1, lum2);
        return (lighter + 0.05) / (darker + 0.05);
      }

      // Find optimal text color for maximum legibility
      function findOptimalTextColor(bgLum) {
        // Test contrast with white and black
        const whiteLum = 1.0;
        const blackLum = 0.0;

        const contrastWithWhite = getContrastRatio(bgLum, whiteLum);
        const contrastWithBlack = getContrastRatio(bgLum, blackLum);

        // Use whichever gives better contrast (aim for WCAG AAA: 7:1)
        if (contrastWithWhite > contrastWithBlack) {
          // Use white/light text
          return '#ffffff';
        } else {
          // Use black/dark text
          return '#000000';
        }
      }

      // Find optimal link color based on background and text color
      function findOptimalLinkColor(bgLum, textColor) {
        const isDarkText = textColor === '#000000';

        if (isDarkText) {
          // For dark text on light background, use saturated blue
          // Adjust blue darkness based on background lightness
          if (bgLum > 0.6) {
            return '#0052a3'; // Darker blue for very light backgrounds
          } else {
            return '#0066cc'; // Medium blue
          }
        } else {
          // For light text on dark background, use light blue
          if (bgLum < 0.2) {
            return '#66b3ff'; // Lighter blue for very dark backgrounds
          } else {
            return '#88ccff'; // Medium light blue
          }
        }
      }

      // Calculate appropriate text and link colors for maximum legibility
      function getTextColors(c1, c2) {
        // Calculate luminance for both gradient colors
        const [r1, g1, b1] = hslToRgb(c1[0], c1[1], c1[2]);
        const [r2, g2, b2] = hslToRgb(c2[0], c2[1], c2[2]);
        const lum1 = getLuminance(r1, g1, b1);
        const lum2 = getLuminance(r2, g2, b2);

        // Use the darker part of gradient for contrast calculation
        // This ensures text is legible against the darkest part
        const referenceLum = Math.min(lum1, lum2);

        // Find optimal text color
        const textColor = findOptimalTextColor(referenceLum);

        // Find optimal link color based on background and text
        const linkColor = findOptimalLinkColor(referenceLum, textColor);

        return {
          text: textColor,
          link: linkColor
        };
      }

      // Linear interpolation helper
      function lerp(a, b, t) { return a + (b - a) * t; }

      // Calculate gradient colors for given hour (0-23.99)
      function getThemeColors(hour) {
        // Find bracketing stops
        let before = stops[stops.length - 1];
        let after = stops[0];
        for (let i = 0; i < stops.length; i++) {
          if (stops[i].h <= hour) {
            before = stops[i];
            after = stops[i + 1] || stops[0];
          } else break;
        }

        // Handle 24-hour wraparound (23→0)
        const hourRange = after.h > before.h ? after.h - before.h : (24 - before.h) + after.h;
        const hourProgress = hour > before.h ? hour - before.h : (24 - before.h) + hour;
        const t = hourProgress / hourRange;

        // Interpolate gradient colors (each gradient mixes two hues)
        const c1 = [
          Math.round(lerp(before.c1[0], after.c1[0], t)),
          Math.round(lerp(before.c1[1], after.c1[1], t)),
          Math.round(lerp(before.c1[2], after.c1[2], t))
        ];
        const c2 = [
          Math.round(lerp(before.c2[0], after.c2[0], t)),
          Math.round(lerp(before.c2[1], after.c2[1], t)),
          Math.round(lerp(before.c2[2], after.c2[2], t))
        ];

        // Calculate appropriate text colors based on background luminance
        const colors = getTextColors(c1, c2);

        return {
          gradient1: `hsl(${c1[0]}, ${c1[1]}%, ${c1[2]}%)`,
          gradient2: `hsl(${c2[0]}, ${c2[1]}%, ${c2[2]}%)`,
          text: colors.text,
          link: colors.link
        };
      }

      // Update CSS variables with current theme
      function updateTheme() {
        const now = new Date();
        const hour = now.getHours() + (now.getMinutes() / 60);
        const colors = getThemeColors(hour);

        document.documentElement.style.setProperty('--gradient-color-1', colors.gradient1);
        document.documentElement.style.setProperty('--gradient-color-2', colors.gradient2);
        document.documentElement.style.setProperty('--text-color', colors.text);
        document.documentElement.style.setProperty('--link-color', colors.link);
      }

      // Initialize theme on page load
      updateTheme();

      // Update every 2 minutes (120000ms)
      setInterval(updateTheme, 120000);

      // Debug mode: Toggle time slider with 'd' key
      let debugSlider = null;
      document.addEventListener('keydown', function(e) {
        if (e.key === 'd' || e.key === 'D') {
          if (debugSlider) {
            // Hide slider
            debugSlider.remove();
            debugSlider = null;
            // Restore current time
            updateTheme();
          } else {
            // Show slider
            debugSlider = document.createElement('div');
            debugSlider.style.cssText = 'position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); padding: 15px 25px; border-radius: 8px; z-index: 9999; font-family: monospace; color: white;';
            debugSlider.innerHTML = `
              <label style="display: block; margin-bottom: 8px; font-size: 14px;">Debug Time: <span id="time-display">12:00</span></label>
              <input type="range" id="hour-slider" min="0" max="23.99" step="0.01" value="12" style="width: 300px; cursor: pointer;">
              <div style="margin-top: 8px; font-size: 12px; opacity: 0.7;">Press 'd' to close</div>
            `;
            document.body.appendChild(debugSlider);

            const hourSlider = document.getElementById('hour-slider');
            const timeDisplay = document.getElementById('time-display');

            hourSlider.addEventListener('input', function() {
              const hour = parseFloat(this.value);
              const hours = Math.floor(hour);
              const minutes = Math.round((hour - hours) * 60);
              timeDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;

              const colors = getThemeColors(hour);
              document.documentElement.style.setProperty('--gradient-color-1', colors.gradient1);
              document.documentElement.style.setProperty('--gradient-color-2', colors.gradient2);
              document.documentElement.style.setProperty('--text-color', colors.text);
              document.documentElement.style.setProperty('--link-color', colors.link);
            });

            // Set initial time display
            const now = new Date();
            const currentHour = now.getHours() + (now.getMinutes() / 60);
            hourSlider.value = currentHour;
            const hours = Math.floor(currentHour);
            const minutes = Math.round((currentHour - hours) * 60);
            timeDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
          }
        }
      });
    })();
    </script>
</body>
</html>